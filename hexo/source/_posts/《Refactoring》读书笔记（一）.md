---
title: 《Refactoring》读书笔记（一）
categories:
  - 读书笔记
date: 2018-11-21 13:20:26
tags: Books
---
[TOC]



# 第一章 重构，第一个案例

> 如果你发现自己需要为程序添加一个特效，而代码结构使你无法很方便地达成目的，那就先重构那个程序，使特性的添加比较容易进行，然后再添加特性。

> 重构前，先检查自己是否有一套可靠的测试机制。这些测试必须有自我检验能力。

> 任何一个傻瓜都能写出计算机可以理解的代码。唯有写出人类容易理解的代码，才是优秀的程序员。

**重构时最好小步前进，如此一来犯错的几率最小。**

（我司的重构一般都是对一个模块使用另一种模式如VIPER/MVP去写，所以都是直接重新写一个模块，然后两者做ABTest以确保无误。。。这种情况真是太难测试了。。。)

> 这个例子给我们最大的启发是重构的节奏：测试、小修改、测试、小修改、测试、小修改。。。。。。正是这种节奏让重构得以快速而安全地前进。

（Emmm。。。我司的方式好像不应该叫重构，而应该叫“重写”。。。）

# 第二章 重构原则

## 何谓重构 what

> * 重构（名词）：对软件内部结构的一种调整，目的是在不改变软件可观察行为的前提下，提高其可理解性，降低其修改成本
> * 重构（动词）：使用一系列重构手法，在不改变软件可观察行为的前提下，调整其结构

### 两顶帽子

使用重构技术开发软件时，你把自己的时间分配给两种截然不同的行为：添加新功能，以及重构。

- 添加新功能时，你不应该修改既有代码，只管添加新功能。通过测试（并让测试正常运行），你可以衡量自己的工作进度。
- 重构时你就不能再添加功能，只管改进程序结构。此时你不应该添加任何测试（除非发现有先前遗漏的东西），只在绝对必要（用以处理接口变化）时才修改测试。

无论何时你都应该清楚自己戴的是哪一顶帽子。

## 为何重构 why

- 重构改进软件设计。如果消除重复代码，就可以确定所有事物和行为在代码中只表述一次，这正是优秀设计的根本。
- 重构使软件更容易理解。早期重构是“擦掉窗户上的污垢，使你看得更远”。
- 重构帮助找到 bug。搞清楚程序结构的同时，也清楚了自己所做的一些假设，于是想不把 bug 揪出来都难。
- 重构提高编程速度。良好设计是维持软件开发速度的根本。

## 何时重构 when

反对专门拨出时间进行重构。重构应该随时随地进行，不应该为重构而重构，之所以重构，是因为你想做别的什么事，而重构可以帮助你把那些事做好。

### 三次法则

第一次做某件事时只管去做；第二次做类似的事时会产生反感，但无论如何还是可以去做；第三次再做类似的事，你就应该重构。

> 事不过三，三则重构。

* 添加功能时重构。
* 修补错误时重构。
* 复审代码时重构。

间接层的价值：

* 允许逻辑共享
* 分开解释意图和实现
* 隔离变化
* 封装条件逻辑

## 重构的难题

* 数据库
* 修改接口
* 难以通过重构手法完成的设计改动
* 何时不该重构

## 重构与设计

重构肩负一项特殊使命：它和设计彼此互补。

重构可以带来更简单的设计，同时又不损失灵活性，这也降低了设计过程的难度。

> 哪怕你完全了解系统，也请实际度量它的性能，不要臆测。臆测会让你学到一些东西，但十有八九你是错的。

## 重构与性能

除了对性能有严格要求的实时系统，其他任何情况下“编写快速软件”的秘诀就是：首先写出可调的软件，然后调整它以求获得足够速度。

## 重构起源何处

# 第三章 代码的坏味道

> P.S. 第三章内容比较多，将单独拎出来一节

# 第四章 构筑测试体系

## 4.1 自测试代码的价值

> 确保所有测试都完全自动化，让它们检查自己的测试结果。
>
> 一套测试就是一个强大的bug侦测器，能够大大缩减查找bug所需要的时间。

## 4.2 JUnit 测试框架

> 频繁地运行测试。每次编译请把测试也考虑进去——每天至少执行每个测试一次。

### 单元测试（Unit Test）和功能测试（Functional Test）

> 每当你收到bug报告，请先写一个单元测试来暴露这个bug。

## 4.3 添加更多测试

> 编写未臻完善的测试并实际运行，好过对完美测试的无尽等待。
>
> 考虑可能出错的边界条件，把测试火力集中在那儿。
>
> 当事情被认为应该会出错时，别忘了检查是否抛出了预期的异常。
>
> 不要因为测试无法捕捉到所有 bug 就不写测试，因为测试的确可以捕捉到大多数 bug。

# 第五章 重构列表

## 5.1 重构的记录格式

* 名称（name）
* 概要（summary）：适用场景，以及它所做的事情。
* 动机（motivation）：为什么需要这个重构，以及什么情况下不该使用这个重构。
* 做法（mechanics）
* 范例（examples）

## 5.2 寻找引用点

## 5.3 这些重构手法有多成熟

设计模式为重构行为提供了目标。设计模式和重构之间有着一种与生俱来的关系。模式是你希望到达的目标，重构则是到达之路。


